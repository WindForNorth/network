### 四、P2P文件分发

​		使用P2P体系结构能够对总是打开的基础设施服务器有最小的依赖，因为每个对等方能够向其他任何对等方发送其已经收到的文件的任何部分

1.P2P体系结构的扩展性

- 对于使用客户-服务器模式的下载模式依赖于服务器对文件的上传速度和客户自己的下载速度。并且随着对等方的数量的增加，服务器需要上传的文件副本增多，上传速度自然降低，此时对等方的下载速度主要就受客户数量的制约，D(cs)=max{NF/us,F/d(min)}

- 使用P2P体系结构，当一个对等方接收到文件的副本的时候，对等方能够使用自己的上载能力将此文件再发送给其他对等方。系统总上载能力等于服务器的上载速率再加上每个单独对等方的上载速率。因此使用P2P文件分发的分发速率D(p2p)=

  ​										max{F/us,F/d(min),NF/(u1+u1+...+un)}

F为单个文件的大小，us为服务器的上载速率，N为需要本文件的对等方的个数，ui为单个对等方的上载速率，d(min)为对等方的最小下载速率

从上面两个对比，能够看出采用P2P的文件分发具有自扩展性，每个对等方既是bit的消费者同时也是重新分发者

2.BitTorrent

​		一种用于文件分发的流行P2P协议。

- 每个参与特定文件分发的对等方的集合称为**洪流**，每个洪流有一个基础设施结点，称为追踪器用于监测洪流中的对等方
- 追踪器随机将参与对等方的集合的子集随机挑选一个将这个子集中的对等方的IP地址发给新加入的对等方，这个新加入的对等方视图与这些子集中的对等方建立TCP连接，这些建立TCP连接的就称为邻近对等方
- 建立TCP连接的对等方之间进行文件的互换
- 最稀缺优先技术：一个对等方针对其没有的数据块在他的邻居中决定最稀缺的块（即在ta的邻居中副本数量最少的块）

### 五、视频流和内容分发网

​		录制好的视频预先放置在服务器上并且提供不同的比特率版本，以供客户拉取

1.HTTP流和DASH

- http流视频服务器以尽可能高的速率将视频文件传输至客户端，客户端将视频文件缓存，到达一定量是就会开始播放。缺陷：客户端接收可用带宽在不同时间或者根据不同客户会有很大波动，这将导致用户出现播放卡顿
- DASH（经HTTP的动态适应性流）：在DASH中，视频编码为几个不同码率的版本，每个版本有一个URL，服务器使用一个告示文件告知客户每个版本的URL。客户每次使用GET方法指定一个URL和一个字节范围请求一个相应版本的块，测量接收带宽并运行特定的速率决定算法确定下一次选择的版本

2.内容分发网（CDN）

内容分发网分布在全世界不同的地理位置的服务器上，在其服务器上存储视频，将用户请求定向到一个将提供最好体验的CDN服务器上

- CND操作：大部分CDN利用DNS截获和重定向。用户对一个CDN服务器发送请求，该CDN判断此时最适合该用户的CDN集群。比如当用户访问一个特定的视频网页时，向本地DNS服务器发送查询请求，该本地DNS服务器将请求中继到网页的权威DNS服务器，该服务器注意到请求URL中的特定标识符比如视频就是video，就返回分发该视频的服务器的主机名给本地服务器，此时本地服务器再去访问这个主机名对应的权威DNS服务器，然后返回其IP地址
- 集群选择策略：简单策略就是根据请求客户IP地址判断距离其最近的服务器；另一种基于流量的条件，CDN对用户和其集群的时延和丢包率执行周期实时查询